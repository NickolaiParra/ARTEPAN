<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Página Principal</title>
    <style>
        body {
            margin: 0;
            background: #fff;
            font-family: Inter, sans-serif;
        }
    </style>
</head>
<style>
  body {
      margin: 0;
      background: #fff;
      font-family: Inter, sans-serif;
  }
  input {
      width: 100%;
      height: 100%;
      border: none;
      outline: none;
      font-size: 14px;
      font-family: Inter, sans-serif;
      background: transparent;
      color: #343C6A;
  }
  button {
      width: 195px;
      height: 64px;
      background: #1814F3;
      border-radius: 9px;
      color: white;
      font-size: 15px;
      font-family: Inter, sans-serif;
      border: none;
      cursor: pointer;
  }
  button:hover {
      background: #0f0ecb;
  }
  .campo-container {
      background: white;
      border-radius: 15px;
      border: 1px #DFEAF2 solid;
      padding: 10px;
  }
  .label {
      color: #232323;
      font-size: 13px;
      font-family: Inter, sans-serif;
  }
  .sidebar-link {
      position: absolute;
      color: #B1B1B1;
      font-size: 20px;
      font-family: Inter, sans-serif;
      font-weight: 500;
      word-wrap: break-word;
      text-decoration: none;
  }
  .sidebar-link:hover {
      color: #1814F3;
  }
</style>
<body>
    
    <div style="width: 1440px; height: 1024px; position: relative; background: white; overflow: hidden">
        <div style="width: 33.65px; height: 31.73px; left: 34px; top: 831.83px; position: absolute"></div>
        <div style="width: 34.99px; height: 33px; left: 36.69px; top: 506.92px; position: absolute"></div>
        <div style="width: 33.65px; height: 31.73px; left: 38.04px; top: 263.23px; position: absolute; overflow: hidden">
          <div style="width: 19.63px; height: 3.80px; left: 7.01px; top: 27.93px; position: absolute; background: #B1B1B1"></div>
          <div style="width: 19.63px; height: 3.97px; left: 7.01px; top: 0px; position: absolute; background: #B1B1B1"></div>
          <div style="width: 7.01px; height: 9.80px; left: 26.64px; top: 4.37px; position: absolute; background: #B1B1B1"></div>
          <div style="width: 19.63px; height: 21.15px; left: 7.01px; top: 5.29px; position: absolute; background: #B1B1B1"></div>
          <div style="width: 7.01px; height: 9.80px; left: 0px; top: 17.55px; position: absolute; background: #B1B1B1"></div>
        </div>
        <div style="width: 33.65px; height: 31.73px; left: 38.04px; top: 345.73px; position: absolute; overflow: hidden">
          <img style="width: 28.07px; height: 30.40px; left: 2.76px; top: 0; position: absolute; border-radius: 20px" src="img/mi-perfil.png" />
        </div>
        <div style="width: 33.65px; height: 31.73px; left: 38.04px; top: 182px; position: absolute; overflow: hidden">
          <img style="width: 33.64px; height: 31.73px; left: 0px; top: 0px; position: absolute; border-radius: 20px" src="img/inicio.png" />
        </div>
        <div style="width: 350px; height: 1px; left: 905px; top: 269px; position: absolute"></div>
        <div style="width: 1190px; height: 1px; left: 250px; top: 100px; position: absolute; background: #E6EFF5"></div>
        <div style="width: 1190px; height: 923px; left: 250px; top: 101px; position: absolute; background: #F5F7FA"></div>
        <div style="left: 290px; top: 275px; position: absolute; color: #333B69; font-size: 22px; font-family: Inter; font-weight: 600; word-wrap: break-word">Pedidos anuales</div>
        <div style="width: 540px; height: 282px; left: 290px; top: 322px; position: absolute; background: white; border-radius: 25px;">
          <canvas id="graficaPedidos" style="width: 100%; height: 100%; border-radius: 25px;"></canvas>
      </div>   
        <div style="left: 290px; top: 628px; position: absolute; color: #333B69; font-size: 22px; font-family: Inter; font-weight: 600;">Mis productos favoritos</div>
        <div id="productos-favoritos"></div>
        
        <div style="left: 947px; top: 628px; position: absolute; color: #333B69; font-size: 22px; font-family: Inter; font-weight: 600;">Últimos pedidos</div>
        <div style="width: 475px; height: 300px; left: 942px; top: 673px; position: absolute; background: white; border-radius: 25px"></div>
        <div id="ultimos-pedidos"></div>
        <!-- Tarjeta: Pedidos en camino -->
        <div style="width: 350px; height: 120px; left: 290px; top: 131px; position: absolute; background: white; border-radius: 25px"></div>
        <div id="pedidos-en-camino" style="left: 423px; top: 193px; position: absolute; color: #232323; font-size: 20px; font-family: Inter; font-weight: 600;">Cargando...</div>
        <div style="left: 423px; top: 166px; position: absolute; color: #718EBF; font-size: 16px; font-family: Inter;">Pedidos en camino</div>
        <img style="width: 70px; height: 70px; left: 338px; top: 156px; position: absolute; border-radius: 9999px" src="img/pedidos-camino.png" />
        <div style="left: 977px; top: 700px; position: absolute; color: #718EBF; font-size: 16px; font-family: Inter; font-weight: 500; word-wrap: break-word">Pedido</div>
        <div style="left: 1059px; top: 700px; position: absolute; color: #718EBF; font-size: 16px; font-family: Inter; font-weight: 500; word-wrap: break-word">Fecha</div>
        <div style="left: 1190px; top: 700px; position: absolute; text-align: center; color: #718EBF; font-size: 16px; font-family: Inter; font-weight: 500; word-wrap: break-word">Estado</div>
        <div style="width: 87px; left: 1294px; top: 690px; position: absolute; color: #718EBF; font-size: 16px; font-family: Inter; font-weight: 500; word-wrap: break-word">Entrega estimada</div>
        <div style="width: 385px; height: 1px; left: 977px; top: 727px; position: absolute; background: #F4F5F7"></div>
        <!-- Tarjeta: Total pedidos -->
        <div style="width: 350px; height: 120px; left: 670px; top: 131px; position: absolute; background: white; border-radius: 25px"></div>
        <div id="total-pedidos" style="left: 799px; top: 193px; position: absolute; color: #232323; font-size: 20px; font-family: Inter; font-weight: 600;">Cargando...</div>
        <div style="left: 799px; top: 166px; position: absolute; color: #718EBF; font-size: 16px; font-family: Inter;">Total pedidos realizados</div>
        <img style="width: 70px; height: 70px; left: 714px; top: 156px; position: absolute; border-radius: 9999px" src="img/total-pedidos.png" />

        <!-- Tarjeta: Fecha último pedido -->
        <div style="width: 350px; height: 120px; left: 1050px; top: 131px; position: absolute; background: white; border-radius: 25px"></div>
        <div id="fecha-ultimo-pedido" style="left: 1198px; top: 193px; position: absolute; color: #232323; font-size: 20px; font-family: Inter; font-weight: 600;">Cargando...</div>
        <div style="left: 1198px; top: 166px; position: absolute; color: #718EBF; font-size: 16px; font-family: Inter;">Fecha del último pedido</div>
        <img style="width: 70px; height: 70px; left: 1092px; top: 159px; position: absolute; border-radius: 9999px" src="img/fecha-ultimo.png" />
        <img id="avatar-mini" 
          src="" 
          alt="Avatar" 
          style="width: 60px; height: 60px; 
                  left: 1340px; 
                  top: 21px; 
                  position: absolute; 
                  border-radius: 50%; 
                  object-fit: cover;">
        </div>
        <!-- Nombre del usuario en la esquina superior -->
        <div id="nombre-usuario" style="left: 1000px; top: 34px; position: absolute; color: #343C6A; font-size: 28px; font-family: Inter; font-weight: 600; word-wrap: break-word">
          <!-- Aquí aparecerá el nombre del usuario -->
          Usuario1
        </div>
        <!-- Bienvenida personalizada -->
        <div id="bienvenida-usuario" style="width: 403px; height: 221px; left: 891px; top: 319px; position: absolute; color: #343C6A; font-size: 64px; font-family: Inter; font-weight: 600; word-wrap: break-word">
          Bienvenido,<br/>Usuario1
        </div>
        <div style="width: 1px; height: 850px; left: 249px; top: 0px; position: absolute; background: #E6EFF5"></div>
        <img style="width: 172px; height: 138px; left: 42px; top: 7px; position: absolute" src="img/artepan-principal.png" />
        <div style="width: 33.65px; height: 31.73px; left: 34px; top: 831.83px; position: absolute"></div>
        <div style="width: 33.65px; height: 31.73px; left: 38.04px; top: 263.23px; position: absolute; overflow: hidden">
          <div style="width: 19.63px; height: 3.80px; left: 7.01px; top: 27.93px; position: absolute; background: #B1B1B1"></div>
          <div style="width: 19.63px; height: 3.97px; left: 7.01px; top: 0px; position: absolute; background: #B1B1B1"></div>
          <div style="width: 7.01px; height: 9.80px; left: 26.64px; top: 4.37px; position: absolute; background: #B1B1B1"></div>
          <div style="width: 19.63px; height: 21.15px; left: 7.01px; top: 5.29px; position: absolute; background: #B1B1B1"></div>
          <div style="width: 7.01px; height: 9.80px; left: 0px; top: 17.55px; position: absolute; background: #B1B1B1"></div>
        </div>
        <div style="width: 33.65px; height: 31.73px; left: 38.04px; top: 345.73px; position: absolute; overflow: hidden">
          <img style="width: 28.07px; height: 30.40px; left: 2.76px; top: 0; position: absolute; border-radius: 20px" src="img/mi-perfil.png" />
        </div>
        <div style="width: 37px; height: 34px; left: 35px; top: 436px; position: absolute; overflow: hidden">
          <img style="width: 37px; height: 34px; left: 0px; top: 0px; position: absolute; border-radius: 20px" src="img/cerrar-sesion.png" />
        
      </div>
      <!-- Barra lateral -->
      <a href="principal.html" style="left: 106.68px; top: 184.54px;" class="sidebar-link">Inicio</a>
      <a href="perfil.html" style="left: 106.85px; top: 351.78px;" class="sidebar-link">Mi perfil</a>
      <a href="index.html" style="left: 108px; top: 440px;" class="sidebar-link">Cerrar sesión</a>
      <a href="pedidos.html" style="left: 108px; top: 265px;" class="sidebar-link">Mis pedidos</a>
      <script>
        // Cargar datos del usuario desde localStorage
        const cliente = JSON.parse(localStorage.getItem('cliente'));
      
        if (cliente) {
            // Mostrar el nombre de usuario real
            document.getElementById('nombre-usuario').textContent = cliente.cli_nombre_comercial;
            const rutaFoto = `img/perfil_cliente${cliente.cli_id}.png`;
            document.getElementById('avatar-mini').src = rutaFoto;
            document.getElementById('bienvenida-usuario').innerHTML = `Bienvenido,<br/>${cliente.cli_nombre_comercial}`;
        } else {
            // Si no hay datos, redirigir al login
            alert("Debes iniciar sesión primero");
            window.location.href = "index.html";
        }
      </script>
      <script>
        if (cliente) {
            const formData = new FormData();
            formData.append('cli_id', cliente.cli_id);
        
            fetch('api_principal.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Actualizar valores en la página
                    document.getElementById('pedidos-en-camino').textContent = `${data.pedidos_en_camino} pedidos`;
                    document.getElementById('total-pedidos').textContent = `${data.total_pedidos} pedidos`;
                    document.getElementById('fecha-ultimo-pedido').textContent = data.fecha_ultimo_pedido || "Sin pedidos";
                } else {
                    alert("Error: " + data.error);
                }
            })
            .catch(error => {
                console.error("Error:", error);
                alert("No se pudo cargar la información");
            });
        } else {
            alert("Debes iniciar sesión");
            window.location.href = "index.html";
        }
        </script>
        <script>
          if (!cliente) {
              alert("Debes iniciar sesión primero");
              window.location.href = "index.html";
          } else {
              // Mostrar nombre en la esquina
              document.getElementById('nombre-usuario').textContent = cliente.cli_nombre_comercial;
      
              // Cargar productos favoritos
              const formData = new FormData();
              formData.append('cli_id', cliente.cli_id);
      
              fetch('api_productos_favoritos.php', {
                  method: 'POST',
                  body: formData
              })
              .then(response => response.json())
              .then(data => {
                  if (data.success) {
                      const productos = data.productos;
                      const contenedor = document.getElementById('productos-favoritos');
      
                      productos.forEach((producto, index) => {
                          const topOffset = 673 + (index * 105); // Ajusta la posición vertical
                          const productoHTML = `
                              <div style="width: 635px; height: 90px; left: 281px; top: ${topOffset}px; position: absolute; background: white; border-radius: 20px"></div>
                              <div style="width: 200px; left: 376px; top: ${topOffset + 23}px; position: absolute; color: #232323; font-size: 16px; font-family: Inter; font-weight: 500;">${producto.pro_nombre}</div>
                              <div style="left: 376px; top: ${topOffset + 49}px; position: absolute; color: #718EBF; font-size: 15px; font-family: Inter;">${producto.total_pedidos} pedidos</div>
                              <div style="left: 619px; top: ${topOffset + 23}px; position: absolute; color: #232323; font-size: 16px; font-family: Inter; font-weight: 500;">$${producto.pro_precio_unitario.toLocaleString()}</div>
                          `;
                          contenedor.insertAdjacentHTML('beforeend', productoHTML);
                      });
                  } else {
                      console.error("No se pudieron cargar los productos favoritos:", data.error);
                  }
              })
              .catch(error => {
                  console.error("Error al cargar productos favoritos:", error);
              });
          }
      </script>
      <script>
        // Cargar datos del cliente desde localStorage
        if (!cliente) {
            alert("Debes iniciar sesión primero");
            window.location.href = "index.html";
        } else {
            const formData = new FormData();
            formData.append('cli_id', cliente.cli_id);
    
            fetch('/Artepan/ultimos_5_pedidos_cliente.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const pedidos = data.pedidos;
                    const container = document.getElementById('ultimos-pedidos');
    
                    pedidos.forEach((pedido, index) => {
                        const topBase = 740 + (index * 48); // espacio entre filas
    
                        const fila = `
                            <div style="left: 974px; top: ${topBase}px; position: absolute; color: #232323; font-size: 16px;">${String(index + 1).padStart(2, '0')}.</div>
                            <div style="left: 1050px; top: ${topBase}px; position: absolute; color: #232323; font-size: 16px;">
                                ${pedido.ped_fecha_pedido.split('T')[0].split('-').reverse().join('/')}
                            </div>
                            <div style="left: 1187px; top: ${topBase}px; position: absolute; color: #232323; font-size: 16px;">${pedido.ped_estado}</div>
                            <div style="left: 1294px; top: ${topBase}px; position: absolute; color: #232323; font-size: 16px;">
                                ${pedido.ped_fecha_entrega.split('T')[0].split('-').reverse().join('/')}
                            </div>
                            <div style="width: 385px; height: 1px; left: 977px; top: ${topBase + 28}px; position: absolute; background: #F4F5F7"></div>
                        `;
                        container.insertAdjacentHTML('beforeend', fila);
                    });
                } else {
                    console.error("Error:", data.error);
                    alert("No se pudieron cargar los últimos pedidos.");
                }
            })
            .catch(error => {
                console.error("Error al obtener últimos pedidos:", error);
                alert("Error de conexión con el servidor.");
            });
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        if (cliente) {
            const formData = new FormData();
            formData.append('cli_id', cliente.cli_id);

            fetch('pedidos_por_anio.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const años = data.datos.map(item => item.año);
                    const totales = data.datos.map(item => item.total);

                    const ctx = document.getElementById('graficaPedidos').getContext('2d');
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: años,
                            datasets: [{
                                label: 'Pedidos por año',
                                data: totales,
                                backgroundColor: 'rgba(54, 162, 235, 0.7)',
                                borderColor: 'rgba(54, 162, 235, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        stepSize: 1
                                    }
                                }
                            }
                        }
                    });
                } else {
                    console.error("Error:", data.error);
                }
            })
            .catch(error => {
                console.error("Error al cargar datos para la gráfica:", error);
            });
        }

    </script>
    
    
</body>
</html> 
